<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AniXp - Ultimate Anime Experience</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --primary: #0a192f;
      --secondary: #172a45;
      --accent: #64ffda;
      --text-primary: #e6f1ff;
      --text-secondary: #8892b0;
      --highlight: #1e90ff;
      --card-bg: #112240;
      --card-hover: #233554;
      --error: #ff6b6b;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background-color: var(--primary);
      color: var(--text-primary);
      line-height: 1.6;
      overflow-x: hidden;
    }

    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 0 20px;
    }

    /* Header Styles */
    header {
      background-color: var(--secondary);
      padding: 20px 0;
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
      position: sticky;
      top: 0;
      z-index: 100;
    }

    .header-content {
      display: flex;
      justify-content: space-between;
      align-items: center;
    }

    .logo {
      display: flex;
      align-items: center;
      gap: 10px;
      font-size: 1.8rem;
      font-weight: 700;
      color: var(--accent);
      text-decoration: none;
    }

    .logo i {
      color: var(--highlight);
    }

    /* Navigation */
    nav ul {
      display: flex;
      list-style: none;
      gap: 25px;
    }

    nav a {
      color: var(--text-primary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
      position: relative;
    }

    nav a:hover {
      color: var(--accent);
    }

    nav a::after {
      content: '';
      position: absolute;
      bottom: -5px;
      left: 0;
      width: 0;
      height: 2px;
      background-color: var(--accent);
      transition: width 0.3s;
    }

    nav a:hover::after {
      width: 100%;
    }

    /* Hero Section */
    .hero {
      height: 500px;
      background: linear-gradient(rgba(10, 25, 47, 0.8), rgba(10, 25, 47, 0.8)), 
                  url('https://images.unsplash.com/photo-1633613286848-e6f43bbafb8d?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1470&q=80') center/cover no-repeat;
      display: flex;
      align-items: center;
      margin-bottom: 50px;
      border-radius: 10px;
    }

    .hero-content {
      max-width: 600px;
      padding: 0 30px;
    }

    .hero h1 {
      font-size: 3rem;
      margin-bottom: 20px;
      color: var(--accent);
      text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);
    }

    .hero p {
      font-size: 1.2rem;
      margin-bottom: 30px;
      color: var(--text-primary);
      text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
    }

    .hero-buttons {
      display: flex;
      gap: 15px;
    }

    .btn {
      padding: 12px 25px;
      border-radius: 5px;
      font-weight: 600;
      text-decoration: none;
      transition: all 0.3s;
      cursor: pointer;
    }

    .btn-primary {
      background-color: var(--accent);
      color: var(--primary);
    }

    .btn-primary:hover {
      background-color: transparent;
      color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent);
    }

    .btn-secondary {
      background-color: transparent;
      color: var(--accent);
      box-shadow: 0 0 0 2px var(--accent);
    }

    .btn-secondary:hover {
      background-color: var(--accent);
      color: var(--primary);
    }

    /* Search Bar */
    #searchBar {
      position: relative;
      margin: 30px 0;
      max-width: 800px;
      margin: 0 auto 50px;
    }

    #searchInput {
      width: 100%;
      padding: 15px 20px;
      font-size: 1.1rem;
      border: none;
      border-radius: 30px;
      outline: none;
      background-color: var(--secondary);
      color: var(--text-primary);
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
      transition: all 0.3s;
    }

    #searchInput:focus {
      box-shadow: 0 0 0 3px var(--accent);
    }

    #searchInput::placeholder {
      color: var(--text-secondary);
    }

    #searchResults {
      position: absolute;
      background: var(--secondary);
      width: 100%;
      z-index: 10;
      max-height: 500px;
      overflow-y: auto;
      border-radius: 0 0 10px 10px;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.3);
      display: none;
    }

    .search-item {
      padding: 15px 20px;
      border-bottom: 1px solid var(--primary);
      cursor: pointer;
      display: flex;
      align-items: center;
      gap: 15px;
      transition: background-color 0.2s;
    }

    .search-item:hover {
      background-color: var(--primary);
    }

    .search-item img {
      width: 50px;
      height: 70px;
      object-fit: cover;
      border-radius: 5px;
    }

    .search-item-info {
      flex: 1;
    }

    .search-item-title {
      font-weight: 600;
      margin-bottom: 5px;
    }

    .search-item-meta {
      display: flex;
      gap: 10px;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    /* Section Styles */
    .section {
      margin-bottom: 60px;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 30px;
      padding-bottom: 10px;
      border-bottom: 2px solid var(--secondary);
    }

    .section-title {
      font-size: 1.8rem;
      color: var(--accent);
      display: flex;
      align-items: center;
      gap: 10px;
    }

    .view-all {
      color: var(--text-secondary);
      text-decoration: none;
      font-weight: 500;
      transition: color 0.3s;
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .view-all:hover {
      color: var(--accent);
    }

    /* Anime Grid */
    .anime-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
      gap: 25px;
    }

    .anime-card {
      background-color: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
      transition: all 0.3s;
      cursor: pointer;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      position: relative;
    }

    .anime-card:hover {
      transform: translateY(-10px);
      box-shadow: 0 15px 30px rgba(0, 0, 0, 0.3);
      background-color: var(--card-hover);
    }

    .anime-card-img {
      width: 100%;
      height: 300px;
      object-fit: cover;
      display: block;
    }

    .anime-card-content {
      padding: 15px;
    }

    .anime-card-title {
      font-weight: 600;
      margin-bottom: 8px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .anime-card-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .anime-card-score {
      color: var(--accent);
      font-weight: 600;
      display: flex;
      align-items: center;
      gap: 3px;
    }

    .anime-card-badge {
      position: absolute;
      top: 10px;
      right: 10px;
      background-color: var(--highlight);
      color: white;
      padding: 5px 10px;
      border-radius: 5px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    /* Featured Anime */
    .featured-anime {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      gap: 30px;
      margin-bottom: 50px;
    }

    .featured-card {
      background-color: var(--card-bg);
      border-radius: 10px;
      overflow: hidden;
      display: flex;
      transition: all 0.3s;
      box-shadow: 0 8px 20px rgba(0, 0, 0, 0.2);
      height: 180px;
    }

    .featured-card:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 25px rgba(0, 0, 0, 0.3);
    }

    .featured-img {
      width: 120px;
      height: 100%;
      object-fit: cover;
    }

    .featured-content {
      padding: 15px;
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .featured-title {
      font-weight: 600;
      margin-bottom: 10px;
      font-size: 1.1rem;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .featured-synopsis {
      font-size: 0.9rem;
      color: var(--text-secondary);
      display: -webkit-box;
      -webkit-line-clamp: 3;
      -webkit-box-orient: vertical;
      overflow: hidden;
      margin-bottom: 15px;
      flex-grow: 1;
    }

    .featured-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--text-secondary);
    }

    /* Categories */
    .category-tags {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-bottom: 30px;
    }

    .category-tag {
      background-color: var(--secondary);
      color: var(--text-primary);
      padding: 8px 15px;
      border-radius: 20px;
      font-size: 0.9rem;
      cursor: pointer;
      transition: all 0.3s;
    }

    .category-tag:hover {
      background-color: var(--highlight);
      color: white;
    }

    /* Footer */
    footer {
      background-color: var(--secondary);
      padding: 50px 0 20px;
      margin-top: 50px;
    }

    .footer-content {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 30px;
      margin-bottom: 30px;
    }

    .footer-column h3 {
      color: var(--accent);
      margin-bottom: 20px;
      font-size: 1.2rem;
    }

    .footer-column ul {
      list-style: none;
    }

    .footer-column li {
      margin-bottom: 10px;
    }

    .footer-column a {
      color: var(--text-secondary);
      text-decoration: none;
      transition: color 0.3s;
    }

    .footer-column a:hover {
      color: var(--accent);
    }

    .social-links {
      display: flex;
      gap: 15px;
    }

    .social-links a {
      color: var(--text-primary);
      font-size: 1.2rem;
      transition: color 0.3s;
    }

    .social-links a:hover {
      color: var(--accent);
    }

    .copyright {
      text-align: center;
      padding-top: 20px;
      border-top: 1px solid var(--primary);
      color: var(--text-secondary);
      font-size: 0.9rem;
    }

    /* Loading Animation */
    .loading {
      display: flex;
      justify-content: center;
      align-items: center;
      height: 200px;
      grid-column: 1 / -1;
    }

    .spinner {
      width: 50px;
      height: 50px;
      border: 5px solid var(--secondary);
      border-top: 5px solid var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    /* Error Message */
    .error {
      color: var(--error);
      text-align: center;
      padding: 20px;
      grid-column: 1 / -1;
    }

    /* Anime Details Page */
    .anime-details {
      display: none;
      padding: 30px 0;
    }

    .back-button {
      display: inline-flex;
      align-items: center;
      gap: 5px;
      margin-bottom: 20px;
      color: var(--accent);
      text-decoration: none;
      font-weight: 500;
    }

    .anime-details-container {
      display: grid;
      grid-template-columns: 300px 1fr;
      gap: 30px;
    }

    .anime-poster {
      border-radius: 10px;
      width: 100%;
      height: auto;
      box-shadow: 0 10px 20px rgba(0, 0, 0, 0.2);
    }

    .anime-info h1 {
      font-size: 2.5rem;
      margin-bottom: 15px;
      color: var(--accent);
    }

    .anime-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 15px;
      margin-bottom: 20px;
      color: var(--text-secondary);
    }

    .anime-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }

    .anime-synopsis {
      margin-bottom: 25px;
      line-height: 1.7;
    }

    .anime-stats {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 15px;
      margin-bottom: 25px;
    }

    .stat-card {
      background-color: var(--card-bg);
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }

    .stat-value {
      font-size: 1.5rem;
      font-weight: 700;
      color: var(--accent);
      margin-bottom: 5px;
    }

    .stat-label {
      font-size: 0.9rem;
      color: var(--text-secondary);
    }

    .anime-characters {
      margin-top: 40px;
    }

    .characters-grid {
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      gap: 20px;
      margin-top: 20px;
    }

    .character-card {
      background-color: var(--card-bg);
      border-radius: 8px;
      overflow: hidden;
      transition: transform 0.3s;
    }

    .character-card:hover {
      transform: translateY(-5px);
    }

    .character-image {
      width: 100%;
      height: 180px;
      object-fit: cover;
    }

    .character-info {
      padding: 10px;
    }

    .character-name {
      font-weight: 600;
      margin-bottom: 3px;
    }

    .character-role {
      font-size: 0.8rem;
      color: var(--text-secondary);
    }

    /* Responsive Design */
    @media (max-width: 1024px) {
      .anime-details-container {
        grid-template-columns: 1fr;
      }
      
      .anime-poster {
        max-width: 250px;
        margin: 0 auto;
      }
    }

    @media (max-width: 768px) {
      .header-content {
        flex-direction: column;
        gap: 20px;
      }

      nav ul {
        gap: 15px;
      }

      .hero {
        height: auto;
        padding: 80px 0;
        text-align: center;
      }

      .hero-content {
        margin: 0 auto;
      }

      .hero h1 {
        font-size: 2.2rem;
      }

      .hero-buttons {
        justify-content: center;
      }

      .anime-grid {
        grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
      }

      .featured-anime {
        grid-template-columns: 1fr;
      }

      .featured-card {
        flex-direction: column;
        height: auto;
      }

      .featured-img {
        width: 100%;
        height: 200px;
      }
      
      .anime-stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="container header-content">
      <a href="#" class="logo" id="homeLink">
        <i class="fas fa-play"></i>
        <span>AniXp</span>
      </a>
      <nav>
        <ul>
          <li><a href="#" class="nav-link" data-section="home">Home</a></li>
          <li><a href="#" class="nav-link" data-section="anime-list">Anime List</a></li>
          <li><a href="#" class="nav-link" data-section="seasonal">Seasonal</a></li>
          <li><a href="#" class="nav-link" data-section="genres">Genres</a></li>
        </ul>
      </nav>
    </div>
  </header>

  <main class="container">
    <!-- Home Page Content -->
    <div id="homePage">
      <section class="hero">
        <div class="hero-content">
          <h1>Discover Your Next Favorite Anime</h1>
          <p>Explore thousands of anime titles, track your progress, and join our community of anime enthusiasts.</p>
          <div class="hero-buttons">
            <a href="#" class="btn btn-primary" id="browseAnimeBtn">Browse Anime</a>
            <a href="#" class="btn btn-secondary">Join Community</a>
          </div>
        </div>
      </section>

      <div id="searchBar">
        <input type="text" id="searchInput" placeholder="Search for anime...">
        <div id="searchResults"></div>
      </div>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-fire"></i> Trending Now</h2>
          <a href="#" class="view-all" id="viewTrending">View All <i class="fas fa-chevron-right"></i></a>
        </div>
        <div id="trending" class="anime-grid">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-star"></i> Top Rated</h2>
          <a href="#" class="view-all" id="viewTopRated">View All <i class="fas fa-chevron-right"></i></a>
        </div>
        <div id="top-rated" class="anime-grid">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-calendar"></i> Current Season</h2>
          <a href="#" class="view-all" id="viewSeasonal">View All <i class="fas fa-chevron-right"></i></a>
        </div>
        <div id="seasonal" class="anime-grid">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-bolt"></i> Just Added</h2>
          <a href="#" class="view-all" id="viewFeatured">View All <i class="fas fa-chevron-right"></i></a>
        </div>
        <div id="featured" class="featured-anime">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </section>

      <section class="section">
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-tags"></i> Browse by Genre</h2>
        </div>
        <div class="category-tags">
          <div class="category-tag" data-genre="action">Action</div>
          <div class="category-tag" data-genre="adventure">Adventure</div>
          <div class="category-tag" data-genre="comedy">Comedy</div>
          <div class="category-tag" data-genre="drama">Drama</div>
          <div class="category-tag" data-genre="fantasy">Fantasy</div>
          <div class="category-tag" data-genre="horror">Horror</div>
          <div class="category-tag" data-genre="mystery">Mystery</div>
          <div class="category-tag" data-genre="romance">Romance</div>
          <div class="category-tag" data-genre="sci-fi">Sci-Fi</div>
          <div class="category-tag" data-genre="sliceoflife">Slice of Life</div>
          <div class="category-tag" data-genre="sports">Sports</div>
          <div class="category-tag" data-genre="supernatural">Supernatural</div>
        </div>
      </section>
    </div>

    <!-- Anime List Page -->
    <div id="animeListPage" style="display: none;">
      <section class="section">
        <a href="#" class="back-button" id="backFromList"><i class="fas fa-arrow-left"></i> Back to Home</a>
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-list"></i> Anime List</h2>
        </div>
        <div id="animeListContent" class="anime-grid">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- Seasonal Anime Page -->
    <div id="seasonalPage" style="display: none;">
      <section class="section">
        <a href="#" class="back-button" id="backFromSeasonal"><i class="fas fa-arrow-left"></i> Back to Home</a>
        <div class="section-header">
          <h2 class="section-title"><i class="fas fa-calendar"></i> Seasonal Anime</h2>
        </div>
        <div id="seasonalContent" class="anime-grid">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- Genre Anime Page -->
    <div id="genrePage" style="display: none;">
      <section class="section">
        <a href="#" class="back-button" id="backFromGenre"><i class="fas fa-arrow-left"></i> Back to Home</a>
        <div class="section-header">
          <h2 class="section-title" id="genreTitle"><i class="fas fa-tag"></i> Genre</h2>
        </div>
        <div id="genreContent" class="anime-grid">
          <div class="loading">
            <div class="spinner"></div>
          </div>
        </div>
      </section>
    </div>

    <!-- Anime Details Page -->
    <div id="animeDetailsPage" class="anime-details">
      <a href="#" class="back-button" id="backFromDetails"><i class="fas fa-arrow-left"></i> Back</a>
      <div class="anime-details-container" id="animeDetailsContent">
        <!-- Content will be loaded here -->
      </div>
    </div>
  </main>

  <footer>
    <div class="container">
      <div class="footer-content">
        <div class="footer-column">
          <h3>AniXp</h3>
          <p>Your ultimate destination for anime discovery and community.</p>
          <div class="social-links">
            <a href="#"><i class="fab fa-twitter"></i></a>
            <a href="#"><i class="fab fa-facebook"></i></a>
            <a href="#"><i class="fab fa-instagram"></i></a>
            <a href="#"><i class="fab fa-discord"></i></a>
          </div>
        </div>
        <div class="footer-column">
          <h3>Explore</h3>
          <ul>
            <li><a href="#" class="footer-nav" data-section="trending">Popular Anime</a></li>
            <li><a href="#" class="footer-nav" data-section="top-rated">Top Rated</a></li>
            <li><a href="#" class="footer-nav" data-section="seasonal">Seasonal Anime</a></li>
            <li><a href="#" class="footer-nav" data-section="featured">Upcoming</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Community</h3>
          <ul>
            <li><a href="#">Forums</a></li>
            <li><a href="#">Reviews</a></li>
            <li><a href="#">Recommendations</a></li>
            <li><a href="#">Events</a></li>
          </ul>
        </div>
        <div class="footer-column">
          <h3>Legal</h3>
          <ul>
            <li><a href="#">Terms of Service</a></li>
            <li><a href="#">Privacy Policy</a></li>
            <li><a href="#">DMCA</a></li>
            <li><a href="#">Contact Us</a></li>
          </ul>
        </div>
      </div>
      <div class="copyright">
        &copy; 2023 AniXp. All rights reserved. Data provided by Jikan API.
      </div>
    </div>
  </footer>

  <script>
  // Configuration
  const ANILIST_API = 'https://graphql.anilist.co';
  const CACHE_TIME = 3600000; // 1 hour cache

  // DOM Elements
  const searchInput = document.getElementById('searchInput');
  const searchResults = document.getElementById('searchResults');
  
  // Page elements
  const homePage = document.getElementById('homePage');
  const animeListPage = document.getElementById('animeListPage');
  const seasonalPage = document.getElementById('seasonalPage');
  const genrePage = document.getElementById('genrePage');
  const animeDetailsPage = document.getElementById('animeDetailsPage');
  
  // Navigation links
  const navLinks = document.querySelectorAll('.nav-link');
  const footerNavs = document.querySelectorAll('.footer-nav');
  const homeLink = document.getElementById('homeLink');
  const browseAnimeBtn = document.getElementById('browseAnimeBtn');
  
  // Back buttons
  const backFromList = document.getElementById('backFromList');
  const backFromSeasonal = document.getElementById('backFromSeasonal');
  const backFromGenre = document.getElementById('backFromGenre');
  const backFromDetails = document.getElementById('backFromDetails');
  
  // View All buttons
  const viewTrending = document.getElementById('viewTrending');
  const viewTopRated = document.getElementById('viewTopRated');
  const viewSeasonal = document.getElementById('viewSeasonal');
  const viewFeatured = document.getElementById('viewFeatured');
  
  // Genre tags
  const genreTags = document.querySelectorAll('.category-tag');
  
  // Cache object
  const cache = {
    data: {},
    get(key) {
      const item = this.data[key];
      if (item && Date.now() - item.timestamp < CACHE_TIME) {
        return item.data;
      }
      return null;
    },
    set(key, data) {
      this.data[key] = {
        timestamp: Date.now(),
        data
      };
    }
  };

  // Utility functions
  function formatScore(score) {
    return score ? (score / 10).toFixed(1) : 'N/A';
  }

  function formatDate(date) {
    if (!date) return 'Unknown';
    return new Date(date.year, date.month - 1, date.day).toLocaleDateString();
  }
  
  // Show page
  function showPage(page) {
    homePage.style.display = 'none';
    animeListPage.style.display = 'none';
    seasonalPage.style.display = 'none';
    genrePage.style.display = 'none';
    animeDetailsPage.style.display = 'none';
    
    page.style.display = 'block';
    
    // Scroll to top
    window.scrollTo(0, 0);
  }

  // GraphQL query helper
  async function anilistQuery(query, variables = {}) {
    try {
      const response = await fetch(ANILIST_API, {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
          'Accept': 'application/json',
        },
        body: JSON.stringify({
          query,
          variables
        })
      });
      
      const json = await response.json();
      return json.data;
    } catch (error) {
      console.error('AniList query error:', error);
      throw error;
    }
  }

  // Load anime data
  async function loadAnime(sectionId, query, variables = {}) {
    const container = document.getElementById(sectionId);
    if (!container) return;
    
    try {
      // Check cache first
      const cacheKey = `${sectionId}-${JSON.stringify(variables)}`;
      const cachedData = cache.get(cacheKey);
      
      if (cachedData) {
        renderAnime(container, cachedData, sectionId.includes('featured'));
        return;
      }
      
      // Fetch data
      const data = await anilistQuery(query, variables);
      
      // Cache the data
      cache.set(cacheKey, data);
      
      // Render the anime
      renderAnime(container, data, sectionId.includes('featured'));
    } catch (error) {
      console.error(`Error loading ${sectionId}:`, error);
      container.innerHTML = `<p class="error">Failed to load data. Please try again later.</p>`;
    }
  }

  // Render anime to the container
  function renderAnime(container, data, isFeatured = false) {
    if (!container || !data) return;
    
    container.innerHTML = '';
    
    let animeList = [];
    
    // Extract anime list based on query type
    if (data.Page) {
      animeList = data.Page.media || [];
    } else if (data.media) {
      animeList = [data.media];
    } else if (data.trending) {
      animeList = data.trending.media || [];
    } else if (data.popular) {
      animeList = data.popular.media || [];
    } else if (data.season) {
      animeList = data.season.media || [];
    }
    
    if (animeList.length === 0) {
      container.innerHTML = `<p class="error">No anime found.</p>`;
      return;
    }
    
    if (isFeatured) {
      // Render featured anime (horizontal cards)
      animeList.slice(0, 6).forEach(anime => {
        const animeCard = createFeaturedAnimeCard(anime);
        container.appendChild(animeCard);
      });
    } else {
      // Render grid anime cards
      animeList.forEach(anime => {
        const animeCard = createAnimeCard(anime);
        container.appendChild(animeCard);
      });
    }
  }

  // Create standard anime card
  function createAnimeCard(anime) {
    const card = document.createElement('div');
    card.className = 'anime-card';
    card.onclick = () => viewAnimeDetails(anime.id);
    
    const imageUrl = anime.coverImage?.large || anime.coverImage?.medium || 'https://via.placeholder.com/300x450';
    
    card.innerHTML = `
      <img src="${imageUrl}" alt="${anime.title.romaji}" class="anime-card-img">
      <div class="anime-card-content">
        <h3 class="anime-card-title" title="${anime.title.romaji}">${anime.title.romaji}</h3>
        <div class="anime-card-meta">
          <span>${anime.format || 'TV'}</span>
          <span class="anime-card-score"><i class="fas fa-star"></i> ${formatScore(anime.averageScore)}</span>
        </div>
      </div>
      ${anime.popularity ? `<div class="anime-card-badge">#${Math.round(anime.popularity)}</div>` : ''}
    `;
    
    return card;
  }

  // Create featured anime card (horizontal)
  function createFeaturedAnimeCard(anime) {
    const card = document.createElement('div');
    card.className = 'featured-card';
    card.onclick = () => viewAnimeDetails(anime.id);
    
    const imageUrl = anime.coverImage?.large || anime.coverImage?.medium || 'https://via.placeholder.com/300x450';
    const synopsis = anime.description ? anime.description.replace(/<[^>]*>/g, '').substring(0, 150) + (anime.description.length > 150 ? '...' : '') : 'No synopsis available.';
    
    card.innerHTML = `
      <img src="${imageUrl}" alt="${anime.title.romaji}" class="featured-img">
      <div class="featured-content">
        <h3 class="featured-title">${anime.title.romaji}</h3>
        <p class="featured-synopsis">${synopsis}</p>
        <div class="featured-meta">
          <span><i class="fas fa-star"></i> ${formatScore(anime.averageScore)}</span>
          <span><i class="fas fa-calendar"></i> ${formatDate(anime.startDate)}</span>
          <span><i class="fas fa-play"></i> ${anime.episodes || '?'} eps</span>
        </div>
      </div>
    `;
    
    return card;
  }

  // Live search functionality
  async function liveSearch(query) {
    if (!query || query.length < 3) {
      searchResults.style.display = 'none';
      return;
    }
    
    try {
      const cacheKey = `search-${query}`;
      const cachedData = cache.get(cacheKey);
      
      let data;
      if (cachedData) {
        data = cachedData;
      } else {
        const searchQuery = `
          query ($search: String) {
            Page(page: 1, perPage: 8) {
              media(search: $search, type: ANIME) {
                id
                title {
                  romaji
                }
                coverImage {
                  medium
                }
                averageScore
                episodes
                format
              }
            }
          }
        `;
        
        data = await anilistQuery(searchQuery, { search: query });
        cache.set(cacheKey, data);
      }
      
      renderSearchResults(data.Page.media);
    } catch (error) {
      console.error('Search error:', error);
      searchResults.innerHTML = `<div class="search-item">Error loading results</div>`;
      searchResults.style.display = 'block';
    }
  }

  // Render search results
  function renderSearchResults(results) {
    if (!results || results.length === 0) {
      searchResults.innerHTML = `<div class="search-item">No results found</div>`;
      searchResults.style.display = 'block';
      return;
    }
    
    searchResults.innerHTML = '';
    results.forEach(anime => {
      const item = document.createElement('div');
      item.className = 'search-item';
      item.onclick = () => {
        viewAnimeDetails(anime.id);
        searchResults.style.display = 'none';
        searchInput.value = '';
      };
      
      const imageUrl = anime.coverImage?.medium || 'https://via.placeholder.com/50x70';
      
      item.innerHTML = `
        <img src="${imageUrl}" alt="${anime.title.romaji}">
        <div class="search-item-info">
          <div class="search-item-title">${anime.title.romaji}</div>
          <div class="search-item-meta">
            <span>${anime.format || 'TV'}</span>
            <span><i class="fas fa-star"></i> ${formatScore(anime.averageScore)}</span>
            <span>${anime.episodes || '?'} eps</span>
          </div>
        </div>
      `;
      
      searchResults.appendChild(item);
    });
    
    searchResults.style.display = 'block';
  }

  // View anime details
  async function viewAnimeDetails(animeId) {
    try {
      showPage(animeDetailsPage);
      
      // Check cache first
      const cacheKey = `anime-${animeId}`;
      const cachedData = cache.get(cacheKey);
      
      let animeData;
      
      if (cachedData) {
        animeData = cachedData;
        renderAnimeDetails(animeData);
      } else {
        // Fetch anime details
        const query = `
          query ($id: Int) {
            Media(id: $id, type: ANIME) {
              id
              title {
                romaji
                english
                native
              }
              coverImage {
                extraLarge
                large
              }
              bannerImage
              startDate {
                year
                month
                day
              }
              endDate {
                year
                month
                day
              }
              description
              season
              seasonYear
              type
              format
              status
              episodes
              duration
              chapters
              volumes
              genres
              averageScore
              meanScore
              popularity
              trending
              favourites
              studios(isMain: true) {
                nodes {
                  name
                }
              }
              characters(perPage: 10, sort: [ROLE, RELEVANCE, ID]) {
                nodes {
                  name {
                    full
                  }
                  image {
                    large
                  }
                }
              }
              trailer {
                id
                site
                thumbnail
              }
            }
          }
        `;
        
        const data = await anilistQuery(query, { id: animeId });
        animeData = data.Media;
        
        // Cache the data
        cache.set(cacheKey, animeData);
        
        renderAnimeDetails(animeData);
      }
    } catch (error) {
      console.error('Error loading anime details:', error);
      document.getElementById('animeDetailsContent').innerHTML = `
        <div class="error">
          <p>Failed to load anime details. Please try again later.</p>
          <a href="#" class="btn btn-primary" onclick="window.location.reload()">Retry</a>
        </div>
      `;
    }
  }

  // Render anime details
  function renderAnimeDetails(anime) {
    const container = document.getElementById('animeDetailsContent');
    if (!container) return;
    
    const imageUrl = anime.coverImage?.extraLarge || anime.coverImage?.large || 'https://via.placeholder.com/300x450';
    const trailerUrl = anime.trailer?.site === 'youtube' 
      ? `https://www.youtube.com/embed/${anime.trailer.id}`
      : null;
    
    // Format genres
    const genres = anime.genres?.join(', ') || 'N/A';
    
    // Format studios
    const studios = anime.studios?.nodes?.map(s => s.name).join(', ') || 'N/A';
    
    // Format characters
    const characters = anime.characters?.nodes || [];
    
    container.innerHTML = `
      <div>
        <img src="${imageUrl}" alt="${anime.title.romaji}" class="anime-poster">
        ${trailerUrl ? `
          <div style="margin-top: 20px;">
            <h3 style="margin-bottom: 10px; color: var(--accent);">Trailer</h3>
            <iframe width="100%" height="200" src="${trailerUrl}" frameborder="0" allowfullscreen style="border-radius: 8px;"></iframe>
          </div>
        ` : ''}
      </div>
      <div class="anime-info">
        <h1>${anime.title.romaji}</h1>
        ${anime.title.english ? `<h2 style="font-size: 1.2rem; color: var(--text-secondary); margin-bottom: 15px;">${anime.title.english}</h2>` : ''}
        <div class="anime-meta">
          <span><i class="fas fa-star"></i> ${formatScore(anime.averageScore)}</span>
          <span><i class="fas fa-users"></i> ${anime.popularity?.toLocaleString() || 'N/A'}</span>
          <span><i class="fas fa-calendar"></i> ${formatDate(anime.startDate)}</span>
          <span><i class="fas fa-play"></i> ${anime.episodes || '?'} eps</span>
          <span><i class="fas fa-clock"></i> ${anime.duration || 'N/A'} min</span>
          <span><i class="fas fa-tag"></i> ${anime.format || 'TV'}</span>
          <span><i class="fas fa-film"></i> ${anime.status || 'N/A'}</span>
        </div>
        
        <div class="anime-stats">
          <div class="stat-card">
            <div class="stat-value">${anime.trending ? '#' + anime.trending : 'N/A'}</div>
            <div class="stat-label">Trending</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${anime.popularity ? '#' + anime.popularity : 'N/A'}</div>
            <div class="stat-label">Popularity</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${anime.favourites?.toLocaleString() || 'N/A'}</div>
            <div class="stat-label">Favorites</div>
          </div>
          <div class="stat-card">
            <div class="stat-value">${anime.meanScore ? anime.meanScore + '%' : 'N/A'}</div>
            <div class="stat-label">Mean Score</div>
          </div>
        </div>
        
        <div class="anime-synopsis">
          <h3 style="margin-bottom: 10px; color: var(--accent);">Synopsis</h3>
          <p>${anime.description ? anime.description.replace(/<[^>]*>/g, '') : 'No synopsis available.'}</p>
        </div>
        
        <div>
          <h3 style="margin-bottom: 10px; color: var(--accent);">Information</h3>
          <p><strong>Genres:</strong> ${genres}</p>
          <p><strong>Studios:</strong> ${studios}</p>
          <p><strong>Season:</strong> ${anime.season ? `${anime.season} ${anime.seasonYear}` : 'N/A'}</p>
          <p><strong>Format:</strong> ${anime.format || 'N/A'}</p>
        </div>
        
        <!-- Watch Now Button -->
        <div style="display: flex; gap: 10px; margin-top: 20px;">
          <a href="/anime/${anime.id}/1" class="watch-now-btn">
            <i class="fas fa-play"></i> Watch Now
          </a>
          <a href="https://anilist.co/anime/${anime.id}" target="_blank" class="watch-now-btn" style="background-color: var(--background-secondary);">
            <i class="fas fa-external-link-alt"></i> View on AniList
          </a>
        </div>
        
        ${characters.length > 0 ? `
          <div class="anime-characters">
            <h3 style="margin-bottom: 10px; color: var(--accent);">Characters</h3>
            <div class="characters-grid">
              ${characters.map(character => `
                <div class="character-card">
                  <img src="${character.image?.large || 'https://via.placeholder.com/150x225'}" alt="${character.name.full}" class="character-image">
                  <div class="character-info">
                    <div class="character-name">${character.name.full}</div>
                  </div>
                </div>
              `).join('')}
            </div>
          </div>
        ` : ''}
      </div>
    `;
  }

  // Event listeners
  searchInput.addEventListener('input', (e) => {
    liveSearch(e.target.value.trim());
  });

  document.addEventListener('click', (e) => {
    if (e.target !== searchInput) {
      searchResults.style.display = 'none';
    }
  });
  
  // Navigation
  navLinks.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const section = link.dataset.section;
      
      switch(section) {
        case 'home':
          showPage(homePage);
          break;
        case 'anime-list':
          showPage(animeListPage);
          loadAnime('animeListContent', `
            query {
              Page(page: 1, perPage: 24) {
                media(type: ANIME, sort: POPULARITY_DESC) {
                  id
                  title {
                    romaji
                  }
                  coverImage {
                    large
                  }
                  averageScore
                  format
                  episodes
                }
              }
            }
          `);
          break;
        case 'seasonal':
          showPage(seasonalPage);
          loadAnime('seasonalContent', `
            query {
              Page(page: 1, perPage: 24) {
                media(type: ANIME, season: ${getCurrentSeason()}, seasonYear: ${new Date().getFullYear()}, sort: POPULARITY_DESC) {
                  id
                  title {
                    romaji
                  }
                  coverImage {
                    large
                  }
                  averageScore
                  format
                  episodes
                }
              }
            }
          `);
          break;
        case 'genres':
          // Will be handled by genre tags
          break;
      }
    });
  });
  
  // Get current season
  function getCurrentSeason() {
    const month = new Date().getMonth() + 1;
    if (month >= 3 && month <= 5) return 'SPRING';
    if (month >= 6 && month <= 8) return 'SUMMER';
    if (month >= 9 && month <= 11) return 'FALL';
    return 'WINTER';
  }
  
  // Footer navigation
  footerNavs.forEach(link => {
    link.addEventListener('click', (e) => {
      e.preventDefault();
      const section = link.dataset.section;
      
      switch(section) {
        case 'trending':
          showPage(homePage);
          document.getElementById('trending').scrollIntoView({ behavior: 'smooth' });
          break;
        case 'top-rated':
          showPage(homePage);
          document.getElementById('top-rated').scrollIntoView({ behavior: 'smooth' });
          break;
        case 'seasonal':
          showPage(seasonalPage);
          loadAnime('seasonalContent', `
            query {
              Page(page: 1, perPage: 24) {
                media(type: ANIME, season: ${getCurrentSeason()}, seasonYear: ${new Date().getFullYear()}, sort: POPULARITY_DESC) {
                  id
                  title {
                    romaji
                  }
                  coverImage {
                    large
                  }
                  averageScore
                  format
                  episodes
                }
              }
            }
          `);
          break;
        case 'featured':
          showPage(homePage);
          document.getElementById('featured').scrollIntoView({ behavior: 'smooth' });
          break;
      }
    });
  });
  
  // Home link
  homeLink.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(homePage);
  });
  
  // Browse anime button
  browseAnimeBtn.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(animeListPage);
    loadAnime('animeListContent', `
      query {
        Page(page: 1, perPage: 24) {
          media(type: ANIME, sort: POPULARITY_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
  });
  
  // Back buttons
  backFromList.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(homePage);
  });
  
  backFromSeasonal.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(homePage);
  });
  
  backFromGenre.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(homePage);
  });
  
  backFromDetails.addEventListener('click', (e) => {
    e.preventDefault();
    history.back();
  });
  
  // View All buttons
  viewTrending.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(animeListPage);
    loadAnime('animeListContent', `
      query {
        Page(page: 1, perPage: 24) {
          media(type: ANIME, sort: TRENDING_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
  });
  
  viewTopRated.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(animeListPage);
    loadAnime('animeListContent', `
      query {
        Page(page: 1, perPage: 24) {
          media(type: ANIME, sort: SCORE_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
  });
  
  viewSeasonal.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(seasonalPage);
    loadAnime('seasonalContent', `
      query {
        Page(page: 1, perPage: 24) {
          media(type: ANIME, season: ${getCurrentSeason()}, seasonYear: ${new Date().getFullYear()}, sort: POPULARITY_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
  });
  
  viewFeatured.addEventListener('click', (e) => {
    e.preventDefault();
    showPage(animeListPage);
    loadAnime('animeListContent', `
      query {
        Page(page: 1, perPage: 24) {
          media(type: ANIME, sort: POPULARITY_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
  });
  
  // Genre tags
  genreTags.forEach(tag => {
    tag.addEventListener('click', () => {
      const genre = tag.dataset.genre.toUpperCase();
      document.getElementById('genreTitle').innerHTML = `<i class="fas fa-tag"></i> ${tag.textContent}`;
      showPage(genrePage);
      loadAnime('genreContent', `
        query {
          Page(page: 1, perPage: 24) {
            media(type: ANIME, genre: "${genre}", sort: POPULARITY_DESC) {
              id
              title {
                romaji
              }
              coverImage {
                large
              }
              averageScore
              format
              episodes
            }
          }
        }
      `);
    });
  });

  // Initial data load
  window.addEventListener('DOMContentLoaded', () => {
    showPage(homePage);
    
    // Trending
    loadAnime('trending', `
      query {
        Page(page: 1, perPage: 12) {
          media(type: ANIME, sort: TRENDING_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
    
    // Top Rated
    loadAnime('top-rated', `
      query {
        Page(page: 1, perPage: 12) {
          media(type: ANIME, sort: SCORE_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
    
    // Seasonal
    loadAnime('seasonal', `
      query {
        Page(page: 1, perPage: 12) {
          media(type: ANIME, season: ${getCurrentSeason()}, seasonYear: ${new Date().getFullYear()}, sort: POPULARITY_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
          }
        }
      }
    `);
    
    // Featured
    loadAnime('featured', `
      query {
        Page(page: 1, perPage: 6) {
          media(type: ANIME, sort: POPULARITY_DESC) {
            id
            title {
              romaji
            }
            coverImage {
              large
            }
            averageScore
            format
            episodes
            description
            startDate {
              year
              month
              day
            }
          }
        }
      }
    `);
  });
  
  // Handle browser back/forward
  window.addEventListener('popstate', () => {
    // Simple solution - just go back to home
    showPage(homePage);
  });
</script>
</body>
</html>